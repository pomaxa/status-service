<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status Incident - {{block "title" .}}Dashboard{{end}}</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">Status Incident</div>
        <div class="nav-links">
            <a href="/">Dashboard</a>
            <a href="/analytics">Analytics</a>
            <a href="/logs">Logs</a>
            <a href="/admin">Admin</a>
        </div>
    </nav>
    <main class="container">
        {{block "content" .}}{{end}}
    </main>
    <script>
        // Auto-refresh every 30 seconds (pauses when user is typing)
        let refreshTimer = null;
        let isUserActive = false;

        function startRefreshTimer() {
            if (!isUserActive && !refreshTimer) {
                refreshTimer = setTimeout(() => location.reload(), 30000);
            }
        }

        function stopRefreshTimer() {
            if (refreshTimer) {
                clearTimeout(refreshTimer);
                refreshTimer = null;
            }
        }

        // Pause refresh when user interacts with forms
        document.addEventListener('focusin', (e) => {
            if (e.target.matches('input, textarea, select, button')) {
                isUserActive = true;
                stopRefreshTimer();
            }
        });

        document.addEventListener('focusout', (e) => {
            if (e.target.matches('input, textarea, select, button')) {
                isUserActive = false;
                startRefreshTimer();
            }
        });

        // Also pause when modal is open
        const observer = new MutationObserver(() => {
            const modalOpen = document.querySelector('.modal[style*="flex"]');
            if (modalOpen) {
                isUserActive = true;
                stopRefreshTimer();
            }
        });
        observer.observe(document.body, { attributes: true, subtree: true, attributeFilter: ['style'] });

        // Start initial timer
        startRefreshTimer();
    </script>
    {{block "scripts" .}}{{end}}
</body>
</html>
